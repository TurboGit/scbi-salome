
function s-saturne-out-of-tree()
{
    echo false
}

function s-saturne-common-build-depends()
{
    echo s-cmake
}

function s-saturne-ng-build-depends()
{
    echo s-salome-bin
}

function s-saturne-build-depends()
{
    echo os@-autoconf
    echo os@-automake
    echo os@-autotools-dev
    echo os@-libtool
}

function s-saturne-default-build-depends()
{
    echo os@-python3-setuptools
}

function s-saturne-default-depends()
{
    echo os@-python3-setuptools
    echo os@-metis-dev
    echo s-cgns
    echo s-med-file
    echo s-salome-kernel
    echo s-salome-gui
    echo s-yacs
    echo s-smesh
    echo s-paravis
    echo s-paraview
    echo s-med-coupling
}

function s-saturne-common-depends()
{
    echo s-libccmio
    echo s-coolprop
    echo s-eos
    echo s-neptune
    echo s-scotch
    echo s-hdf5
}

function s-saturne-env()
{
    local PREFIX=$1
    local TARGET=$2

    set-var    SATURNE_ROOT_DIR    $PREFIX
    set-var    CS_ROOT_DIR         $PREFIX

    add-to-var PATH            $PREFIX/bin
    add-to-var PATH            $PREFIX/libexec/code_saturne
    add-to-var PYTHONPATH      \
               $PREFIX/lib/python$PYTHON_VERSION/site-packages
}

function s-saturne-pre-config()
{
    local PREFIX=$1
    local TARGET=$2

    rsync -a $(dirname ${SCBI_MODULES_DIR["s-neptune"]})/src/* \
        neptune_cfd

    ../src/sbin/bootstrap
}

function s-saturne-config-options()
{
    local PREFIX=$1
    local TARGET=$2

    echo --prefix=$PREFIX
    echo --enable-relocatable # Indispensable pour dÃ©placer l'installeur
    echo --with-salome=$SALOME_ROOT_DIR
    echo --with-mpi=$MPI_ROOT_DIR
    echo --with-catalyst # Ajouter "=salome" pour scibian12 si besoin
}

function s-saturne-mesa-config-options()
{
    local PREFIX=$1
    local TARGET=$2

    echo --with-catalyst=$PARAVIEW_OSMESA_INSTALL_DIR
    echo --enable-dlopen-rtld-global
}

function s-saturne-config()
{
    local PREFIX=$1
    local TARGET=$2
    local VARIANT=$3

    local OPTIONS=()
    get-config-options OPTIONS $PREFIX $TARGET $VARIANT

    ../src/configure "${OPTIONS[@]}"
}

function s-saturne-build()
{
    local PREFIX=$1
    local TARGET=$2

    make -j$SCBI_JOBS
}

function s-saturne-post-build()
{
    local PREFIX=$1
    local TARGET=$2

    make doc
}

function s-saturne-install()
{
    local PREFIX=$1
    local TARGET=$2

    make install
}

function s-saturne-post-install()
{
    local PREFIX=$1
    local TARGET=$2

    make install-doc

    cd $PREFIX/etc

    local APPEND=`echo "compute_versions = :$(basename $PREFIX)"`
    sed "s|# compute_versions =|${APPEND}|" \
        code_saturne.cfg.template > code_saturne.cfg

    sed "s&distant installation paths&distant installation paths\nslurm_cronos=/sofware/rd/saturne/code_saturne/9.0/arch\nslurm_gaia=/projets/saturne/Code_Saturne/9.0/arch&" code_saturne.cfg > code_saturne.cfg.template

    sed "s&# rcfile =&rcfile =${PREFIX}/etc/salome.rc&" code_saturne.cfg > code_saturne.cfg_rc
    sed "s&compute_versions = :install&compute_versions = :e-saturne-dbg&" code_saturne.cfg_rc > code_saturne.cfg.template

    cp code_saturne.cfg.template code_saturne.cfg
    rm code_saturne.cfg_rc

    cp $SCBI_PLUGINS/support/salome.rc $PREFIX/etc

    # File to store PREFIX, used to be replaced at installation step:
    echo $PREFIX > $PREFIX/saturnePrefix_dir_at_build_time.txt
    # Replace salome install prefix at installation step. Needed for dependancies at runtime (pleiade 32228)
    echo $SALOME_BIN_APPLICATION > $PREFIX/salomeTarPrefix_dir_at_build_time.txt
}
