
#  Install some python modules using pip3. Note that this plug-in do not
#  install dependencies, so the full list of modules to be installed must
#  be explicitly specified.

function s-python-modules-out-of-tree()
{
    echo false
}

function s-python-modules-ng-build-depends()
{
    echo s-salome-bin
}

function s-python-modules-lxml-build-depends()
{
    echo os@-xml2-dev
}

function s-python-modules-pyaml-build-depends()
{
    echo libyaml-dev
}

function s-python-modules-meshio-depends()
{
    echo os@-python3-h5py
    echo os@-python3-netcdf4
    echo os@-python3-cftime
    echo os@-python3-typing-extensions
}

function s-python-modules-pyproj-build-depends()
{
    echo s-proj
}

function s-python-modules-build-depends()
{
    echo os@-python3-pip
}

function s-python-modules-common-build-env()
{
    local PREFIX=$1
    local TARGET=$2

    add-to-var PYTHONPATH        \
               $PREFIX/lib/python$PYTHON_VERSION/site-packages/
}

function s-python-modules-meshio-build-env()
{
    local PREFIX=$1
    local TARGET=$2

    add-to-var PATH $PREFIX/bin
}

function s-python-modules-common-env()
{
    local PREFIX=$1
    local TARGET=$2

    add-to-var PYTHONPATH      \
               $PREFIX/lib/python$PYTHON_VERSION/site-packages/
}

function s-python-modules-meshio-env()
{
    local PREFIX=$1
    local TARGET=$2

    add-to-var PATH $PREFIX/bin
}

function s-python-modules-metadata-config-options()
{
    echo zipp==3.15.0
    echo importlib-metadata
}

function s-python-modules-toml-config-options()
{
    echo toml
}

function s-python-modules-wand-config-options()
{
    echo wand
}

function s-python-modules-lxml-config-options()
{
    echo lxml
}

function s-python-modules-pyaml-config-options()
{
    echo pyaml
}

function s-python-modules-pyproj-config-options()
{
    echo pyproj==3.2.1
}

function s-python-modules-meshio-config-options()
{
    echo numpy==1.20.3
    echo rich==13.7.1
    echo meshio==5.3.5
}

function s-python-modules-telemac-config-options()
{
    echo cppy
    echo traitlets
    echo nbformat
    echo ipython
    echo owslib
    echo pyshp
    echo descartes
    echo fiona==1.8.20
    echo openpyxl
    echo rasterio==1.1.0
    echo doxypypy

    echo jupyter-client==7.4.4
    echo jupyter-console
    echo jupyter
    echo ipywidgets
    echo geopandas==0.6.3
    echo shapely==1.8.0
    echo pylint
    echo pygments==2.4.1
    echo requests==2.28
    echo packaging==21.3
    echo pyzmq==24
    echo python-dateutil==2.8.2
    echo idna==2.8
    echo y-py==0.5.3
    echo jupyter-events==0.5.0 #compatibilit√© avec pyyaml natif s10
}

function s-python-modules-install()
{
    local PREFIX=$1
    local TARGET=$2

    PYPIURL=$(scbi-store-get-key PYPIURL)

    mkdir -p $PREFIX/lib/python$PYTHON_VERSION/site-packages

    local OPTIONS=()
    get-config-options OPTIONS $PREFIX $TARGET $VARIANT

    pip3 install --no-deps \
         --index-url=$PYPIURL \
         --prefix=$PREFIX \
         ${OPTIONS[@]}
}

function s-python-modules-post-install()
{
    local PREFIX=$1
    local TARGET=$2

    local site_file=$(get-os-file /usr/lib/*/*/*/site-patch.py)

    if [[ -f $site_file ]]; then
        cp $site_file $PREFIX/lib/python$PYTHON_VERSION/site-packages/site.py
    fi
}

function s-python-modules-prefix()
{
    echo NONE
}
